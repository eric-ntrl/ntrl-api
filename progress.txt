# NTRL Article Neutralization - Progress Log

## Codebase Patterns
<!-- Add reusable patterns discovered during implementation here -->

---

## Iteration Log

### Setup (2025-01-12)
- Created PRD: docs/prd/article-neutralization-v1.md
- Created prd.json with 18 user stories across 5 phases
- Stored canon: docs/canon/neutralization-canon-v1.md
- Stored content spec: docs/canon/content-spec-v1.md
- Integrated deterministic grader: app/services/grader.py
- Grader spec: app/data/grader_spec_v1.json

### Story 1.1 - Integrate deterministic grader (COMPLETE)
- Verified grader.py exists at app/services/grader.py
- Verified grader_spec_v1.json exists at app/data/grader_spec_v1.json with all deterministic canon rules
- Confirmed `from app.services.grader import grade` works
- Confirmed grade() returns {overall_pass: bool, results: list}
- Note: Some canon rules (A2, A6, B4, B5, C1, C3, C4, D4) require semantic/LLM analysis - these are intentionally not in the deterministic grader

### Story 1.2 - Create /v1/grade endpoint (COMPLETE)
- Created app/schemas/grading.py with GradeRequest, GradeResponse, RuleResult schemas
- Added POST /v1/grade endpoint to app/routers/admin.py
- Endpoint accepts original_text, neutral_text, original_headline, neutral_headline
- Returns {overall_pass, results} from deterministic grader
- FastAPI returns 422 validation error for missing required fields (standard behavior)

### Story 1.3 - Create LLM quality scorer service (COMPLETE)
- Created app/services/quality_scorer.py with score_quality() function
- Returns QualityScore dataclass with {score: float, feedback: str, rule_violations: list}
- Embedded CANON_RUBRIC contains all A1-D4 rules as grading criteria
- Works with OpenAI (gpt-4o-mini) and Anthropic (claude-3-5-haiku) providers
- Tested OpenAI successfully; Anthropic code is correct but account has no credits

### Story 1.4 - Create 10-article test corpus (COMPLETE)
- Created tests/fixtures/test_corpus/ directory
- Created 10 JSON article files with: original_title, original_body, source_url, section, length, has_manipulative_language
- Sections covered: world (3), us (3), technology (2), business (2) - 4 unique sections
- Lengths: short (3), medium (4), long (3)
- 4 articles with manipulative language: 001 (urgency/clickbait), 003 (clickbait/selling), 005 (emotional), 010 (agenda signaling)
- Note: 4 pre-existing test failures unrelated to corpus (classifier, deduper, neutralizer auth)

**Next**: Story 1.5 - Schema migration for new output fields
